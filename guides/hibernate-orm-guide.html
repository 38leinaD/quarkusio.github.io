<!DOCTYPE html>
<html>

<head>
  <title>Quarkus - Using Hibernate ORM and JPA</title>
  <script id="adobe_dtm" src="https://www.redhat.com/dtm.js" type="text/javascript"></script>
  <script src="/assets/javascript/highlightjs-pack.js" type="text/javascript"></script>
  <META HTTP-EQUIV='Content-Security-Policy' CONTENT="default-src 'none'; script-src 'self' 'unsafe-eval' 'sha256-ANpuoVzuSex6VhqpYgsG25OHWVA1I+F6aGU04LoI+5s=' 'sha256-ipy9P/3rZZW06mTLAR0EnXvxSNcnfSDPLDuh3kzbB1w=' js.bizographics.com https://www.redhat.com assets.adobedtm.com jsonip.com https://ajax.googleapis.com https://www.googletagmanager.com https://www.google-analytics.com https://use.fontawesome.com; style-src 'self' https://fonts.googleapis.com https://use.fontawesome.com; img-src 'self' *; media-src 'self' ; frame-src https://www.googletagmanager.com https://www.youtube.com; frame-ancestors 'none'; base-uri 'none'; object-src 'none'; form-action 'none'; font-src 'self' https://use.fontawesome.com https://fonts.gstatic.com;">
  <META HTTP-EQUIV='X-Frame-Options' CONTENT="DENY">
  <META HTTP-EQUIV='X-XSS-Protection' CONTENT="1; mode=block">
  <META HTTP-EQUIV='X-Content-Type-Options' CONTENT="nosniff">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Quarkus: Supersonic Subatomic Java">
  <link rel="shortcut icon" type="image/png" href="/favicon.ico" >
  <link rel="stylesheet" href="/assets/css/main.css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
  <link rel="alternate" type="application/rss+xml"  href="https://quarkus.io//feed.xml" title="Quarkus">
  <script src="https://quarkus.io//assets/javascript/goan.js" type="text/javascript"></script>
  <script src="https://quarkus.io//assets/javascript/hl.js" type="text/javascript"></script>
</head>

<body class="guides">
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NJWS5L"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div class="content">
    <div class="navigation-wrapper">
  <div class="width-12-12">
    <div class="header navigation">
      <div class="logo-wrapper">
        <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
      </div>
      <div class="nav-container">
        <nav>
          <div class="nav-mobile"><a id="nav-toggle" href="#!"><span></span></a></div>
          <ul class="nav-list">
            <li>
              <a href="/get-started/" class="">Get Started</a>
            </li>
            <li>
              <a href="/guides/" class="active">Guides</a>
            </li>
            <li>
              <a href="https://code.quarkus.io">Start Coding</a>
            </li>
            <li>
              <a href="/community/" class="">Community</a>
            </li>
            <li>
              <a href="/blog/" class="">Blog</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

    <div class="guide">
  <div class="width-12-12">
    <h1 class="text-caps">Quarkus - Using Hibernate ORM and JPA</h1>
    <div class="hide-mobile toc">
      <ul class="sectlevel1">
<li><a href="#setting-up-and-configuring-hibernate-orm-without-persistence-xml-recommended">Setting up and configuring Hibernate ORM without <code>persistence.xml</code> (recommended)</a>
<ul class="sectlevel2">
<li><a href="#properties-to-refine-your-hibernate-orm-configuration">Properties to refine your Hibernate ORM configuration</a></li>
</ul>
</li>
<li><a href="#setting-up-and-configuring-hibernate-orm-with-a-persistence-xml">Setting up and configuring Hibernate ORM with a <code>persistence.xml</code></a></li>
<li><a href="#defining-entities-in-external-projects-or-jars">Defining entities in external projects or jars</a></li>
<li><a href="#hibernate-orm-in-development-mode">Hibernate ORM in development mode</a></li>
<li><a href="#caching">Caching</a>
<ul class="sectlevel2">
<li><a href="#caching-of-entities">Caching of entities</a></li>
<li><a href="#caching-of-collections-and-relations">Caching of collections and relations</a></li>
<li><a href="#caching-of-queries">Caching of queries</a></li>
<li><a href="#tuning-of-cache-regions">Tuning of Cache Regions</a></li>
<li><a href="#limitations-of-caching">Limitations of Caching</a></li>
</ul>
</li>
</ul>
    </div>
    <div>
      <div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate ORM is the de facto JPA implementation and offers you the full breath of an Object Relational Mapper.
It works beautifully in Quarkus.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-and-configuring-hibernate-orm-without-persistence-xml-recommended"><a class="anchor" href="#setting-up-and-configuring-hibernate-orm-without-persistence-xml-recommended"></a>Setting up and configuring Hibernate ORM without <code>persistence.xml</code> (recommended)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>More often than not, you need one <em>persistence unit</em> with few configuration options.
In Quarkus, you just need to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add your settings in <code>application.properties</code></p>
</li>
<li>
<p>annotate your entities with <code>@Entity</code> and friends</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and we make some opinionated choices and educated guesses.</p>
</div>
<div class="paragraph">
<p>In your <code>pom.xml</code>, add the following dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the Hibernate ORM extension</p>
</li>
<li>
<p>your JDBC driver extension (<code>quarkus-jdbc-postgresql</code>, <code>quarkus-jdbc-h2</code>, <code>quarkus-jdbc-mariadb</code>, &#8230;&#8203;)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;dependencies&gt;
    &lt;!-- Hibernate ORM specific dependencies --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-hibernate-orm&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;!-- JDBC driver dependencies --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;io.quarkus&lt;/groupId&gt;
        &lt;artifactId&gt;quarkus-jdbc-postgresql&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Annotate your persistent objects with <code>@Entity</code>,
then add the relevant configuration properties in <code>application.properties</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="properties" class="language-properties hljs"># configure your datasource
quarkus.datasource.url = jdbc:postgresql://localhost:5432/mydatabase
quarkus.datasource.driver = org.postgresql.Driver
quarkus.datasource.username = sarah
quarkus.datasource.password = connor

# drop and create the database at startup (use `update` to only update the schema)
quarkus.hibernate-orm.database.generation=drop-and-create</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that these configuration properties are not the same ones as in your typical Hibernate ORM configuration file: they might differ in names, casing and don&#8217;t necessarily map 1:1 to each other.
Please see below for the list of properties you can define.</p>
</div>
<div class="paragraph">
<p>An <code>EntityManagerFactory</code> will be created based on Quarkus <code>datasource</code> configuration as long as the Hibernate ORM extension is declared in your <code>pom.xml</code>.
The dialect will be selected based on the JDBC driver.</p>
</div>
<div class="paragraph">
<p>You can then happily inject your <code>EntityManager</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@ApplicationScoped
public class SantaClausService {
    @Inject
    EntityManager em; <i class="conum" data-value="1"></i><b>(1)</b>

    @Transactional <i class="conum" data-value="2"></i><b>(2)</b>
    public void createGift(String giftDescription) {
        Gift gift = new Gift();
        gift.setName(giftDescription);
        em.persist(gift);
    }
}

//and of course our entity
@Entity
public class Gift {
    private Long id;
    private String name;

    @Id @GeneratedValue(strategy = GenerationType.SEQUENCE, generator="giftSeq")
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Inject your entity manager and have fun</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Mark your CDI bean method as <code>@Transactional</code> and the <code>EntityManager</code> will enlist and flush at commit.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To load some SQL statements when Hibernate ORM starts, add a <code>import.sql</code> in the root of your resources directory.
It contains SQL DML statements terminated by a semicolon.
This is useful to have a data set ready for your tests or demos.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure to wrap methods modifying your database (e.g. <code>entity.persist()</code>) within a transaction. Marking a
CDI bean method <code>@Transactional</code> will do that for you and make that method a transaction boundary. We recommend doing
so at your application entry point boundaries like your REST endpoint controllers.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="properties-to-refine-your-hibernate-orm-configuration"><a class="anchor" href="#properties-to-refine-your-hibernate-orm-configuration"></a>Properties to refine your Hibernate ORM configuration</h3>
<div class="paragraph">
<p>There are optional properties useful to refine your <code>EntityManagerFactory</code> or guide guesses of Quarkus.</p>
</div>
<div class="sect3">
<h4 id="dialect"><a class="anchor" href="#dialect"></a>Dialect</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.dialect</code></dt>
<dd>
<p>(e.g. <code>org.hibernate.dialect.PostgreSQL95Dialect</code>).
Class name of the Hibernate ORM dialect. The complete list of bundled dialects is available in the <a href="https://docs.jboss.org/hibernate/stable/orm/javadocs/org/hibernate/dialect/package-summary.html">Hibernate ORM JavaDoc</a>.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Not all the dialects are supported in GraalVM native executables: we currently provide driver extensions for PostgreSQL, MariaDB, Microsoft SQL Server and H2.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.dialect.storage-engine</code></dt>
<dd>
<p>(e.g. <code>MyISAM</code> or <code>InnoDB</code>).
The storage engine to use when the dialect supports multiple storage engines.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="miscellaneous"><a class="anchor" href="#miscellaneous"></a>Miscellaneous</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.sql-load-script</code></dt>
<dd>
<p>(defaults to <code>/import.sql</code>) Name of the file containing the SQL statements to execute when Hibernate ORM starts.
By default, simply add <code>import.sql</code> in the root of your resources directory and it will be picked up without having to set this property.
Pass <code>no-file</code> to force Hibernate ORM to ignore the SQL import file.
If you need different SQL statements between dev mode, test (<code>@QuarkusTest</code>) and in production, use Quarkus <a href="https://quarkus.io/guides/application-configuration-guide#configuration-profiles">configuration profiles facility</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="property" class="language-property hljs">%dev.quarkus.hibernate-orm.sql-load-script = import-dev.sql
%test.quarkus.hibernate-orm.sql-load-script = import-test.sql
%prod.quarkus.hibernate-orm.sql-load-script = no-file</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Quarkus supports <code>.sql</code> file with SQL statements or comments spread over multiple lines.
Each SQL statement must be terminated by a semicolon.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.batch-fetch-size</code></dt>
<dd>
<p>(defaults to <code>-1</code> i.e. batch fetching is disabled).
The size of the batches used when loading entities and collections.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="query"><a class="anchor" href="#query"></a>Query</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.query.query-plan-cache-max-size</code></dt>
<dd>
<p>The maximum size of the query plan cache.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.query.default-null-ordering</code></dt>
<dd>
<p>(defaults to <code>none</code>).
Default precedence of null values in <code>ORDER BY</code> clauses.
Options are <code>none</code>, <code>first</code>, <code>last</code>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="database"><a class="anchor" href="#database"></a>Database</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.database.generation</code></dt>
<dd>
<p>(e.g. <code>drop-and-create</code> which is awesome in development mode). Select whether the database schema is generated or not.
Options are <code>none</code>, <code>create</code>, <code>drop-and-create</code>, <code>drop</code>, <code>update</code>. The default is <code>none</code>.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.database.generation.halt-on-error</code></dt>
<dd>
<p>(defaults to <code>false</code>)
Whether we should stop on the first error when applying the schema.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.database.default-catalog</code></dt>
<dd>
<p>The default catalog to use for the database objects.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.database.default-schema</code></dt>
<dd>
<p>The default schema to use for the database objects.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.database.charset</code></dt>
<dd>
<p>The charset of the database.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="jdbc"><a class="anchor" href="#jdbc"></a>JDBC</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.jdbc.timezone</code></dt>
<dd>
<p>The time zone pushed to the JDBC driver.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.jdbc.statement-fetch-size</code></dt>
<dd>
<p>How many rows are fetched at a time by the JDBC driver.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.jdbc.statement-batch-size</code></dt>
<dd>
<p>The number of updates (inserts, updates and deletes) that are sent by the JDBC driver at one time for execution.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="logging"><a class="anchor" href="#logging"></a>Logging</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.log.sql</code></dt>
<dd>
<p>(defaults to <code>false</code>).
Show SQL logs and format them nicely.</p>
</dd>
<dt class="hdlist1"><code>quarkus.hibernate-orm.log.jdbc-warnings</code></dt>
<dd>
<p>(defaults to <code>false</code>).
Whether JDBC warnings should be collected and logged.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="statistics"><a class="anchor" href="#statistics"></a>Statistics</h4>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>quarkus.hibernate-orm.statistics</code></dt>
<dd>
<p>(defaults to <code>false</code>)
Whether statistics collection is enabled.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Do not mix <code>persistence.xml</code> and <code>quarkus.hibernate-orm.*</code> properties in <code>application.properties</code>.
Quarkus will raise an exception.
Make up your mind on which approach you want to use.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Want to start a PostgreSQL server on the side with Docker?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="shell" class="language-shell hljs">docker run --ulimit memlock=-1:-1 -it --rm=true --memory-swappiness=0 --name postgres-quarkus-hibernate -e POSTGRES_USER=hibernate -e POSTGRES_PASSWORD=hibernate -e POSTGRES_DB=hibernate_db -p 5432:5432 postgres:10.5</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="setting-up-and-configuring-hibernate-orm-with-a-persistence-xml"><a class="anchor" href="#setting-up-and-configuring-hibernate-orm-with-a-persistence-xml"></a>Setting up and configuring Hibernate ORM with a <code>persistence.xml</code></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Alternatively, you can set a <code>META-INF/persistence.xml</code> to setup Hibernate ORM.
This is useful for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>migrating existing code</p>
</li>
<li>
<p>when you have relatively complex settings requiring the full flexibility of the configuration</p>
</li>
<li>
<p>or if you like it the good old way</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you have a <code>persistence.xml</code>, then you cannot use the <code>quarkus.hibernate-orm.*</code> properties
and only persistence units defined in <code>persistence.xml</code> will be taken into account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Your <code>pom.xml</code> dependencies as well as your Java code would be identical to the precedent example. The only
difference is that you would specify your Hibernate ORM configuration in <code>META-INF/persistence.xml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://xmlns.jcp.org/xml/ns/persistence
             http://xmlns.jcp.org/xml/ns/persistence/persistence_2_1.xsd"
             version="2.1"&gt;

    &lt;persistence-unit name="CustomerPU" transaction-type="JTA"&gt;

        &lt;description&gt;My customer entities&lt;/description&gt;

        &lt;properties&gt;
            &lt;!-- Connection specific --&gt;
            &lt;property name="hibernate.dialect" value="org.hibernate.dialect.PostgreSQL95Dialect"/&gt;

            &lt;property name="hibernate.show_sql" value="true"/&gt;
            &lt;property name="hibernate.format_sql" value="true"/&gt;

            &lt;!--
                Optimistically create the tables;
                will cause background errors being logged if they already exist,
                but is practical to retain existing data across runs (or create as needed) --&gt;
            &lt;property name="javax.persistence.schema-generation.database.action" value="drop-and-create"/&gt;

            &lt;property name="javax.persistence.validation.mode" value="NONE"/&gt;
        &lt;/properties&gt;

    &lt;/persistence-unit&gt;
&lt;/persistence&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="defining-entities-in-external-projects-or-jars"><a class="anchor" href="#defining-entities-in-external-projects-or-jars"></a>Defining entities in external projects or jars</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Hibernate ORM in Quarkus relies on compile-time bytecode enhancements to your entities. If you define your entities in the
same project where you build your Quarkus application, everything will work fine. If the entities come from external projects
or jars, you can make sure that your jar is treated like a Quarkus application library by adding an empty <code>META-INF/beans.xml</code> file.
This will allow Quarkus to index and enhance your entities as if they were inside the current project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="hibernate-orm-in-development-mode"><a class="anchor" href="#hibernate-orm-in-development-mode"></a>Hibernate ORM in development mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quarkus development mode is really useful for applications that mix front end or services and database access.
There are a few common approaches to make the best of it.</p>
</div>
<div class="paragraph">
<p>The first choice is to use <code>quarkus.hibernate-orm.database.generation=drop-and-create</code> in conjunction with <code>import.sql</code>.
That way for every change to your app and in particular to your entities, the database schema will be properly recreated
and your data fixture (stored in <code>import.sql</code>) will be used to repopulate it from scratch.
This is best to perfectly control your environment and works magic with Quarkus live reload mode:
your entity changes or any change to your <code>import.sql</code> is immediately picked up and the schema updated without restarting the application!</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>By default, Hibernate ORM, upon boot, will read and execute the SQL statements in the <code>/import.sql</code> file (if present).
You can change the file name by changing the property <code>quarkus.hibernate-orm.sql-load-script</code> in <code>application.properties</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The second approach is to use <code>quarkus.hibernate-orm.database.generation=update</code>.
This approach is best when you do many entity changes but
still need to work on a copy of the production data
or if you want to reproduce a bug that is based on specific database entries.
<code>update</code> is a best effort from Hibernate ORM and will fail in specific situations
including altering your database structure which could lead to data loss.
For example if you change structures related to the foreign key, Hibernate ORM might have to bail out.
But for development, these limitations are acceptable.</p>
</div>
<div class="paragraph">
<p>The third approach is to use <code>quarkus.hibernate-orm.database.generation=none</code>.
This approach is best when you are working on a copy of the production data but want to fully control the schema evolution.
Or if you use a database schema migration tool like <a href="https://quarkus.io/guides/flyway-guide">Flyway</a>.
When you make a change to an entity, make sure to adapt the database schema accordingly.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Do not use <code>quarkus.hibernate-orm.database.generation</code> <code>drop-and-create</code> and <code>update</code> in your production environment. You have been warned :)
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It becomes really powerful when combined with Quarkus configuration profiles.
You can define different <a href="https://quarkus.io/guides/application-configuration-guide#configuration-profiles">configuration profiles</a>
to select different behaviors depending on your environment.
This is great because you can define different combinations of Hibernate ORM properties matching the development style you currently need.</p>
</div>
<div class="listingblock">
<div class="title">application.properties</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">%dev.quarkus.hibernate-orm.database.generation = drop-and-create
%dev.quarkus.hibernate-orm.sql-load-script = import-dev.sql

%dev-with-data.quarkus.hibernate-orm.database.generation = update
%dev-with-data.quarkus.hibernate-orm.sql-load-script = no-file

%prod.quarkus.hibernate-orm.database.generation = none
%prod.quarkus.hibernate-orm.sql-load-script = no-file</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">./mvnw compile quarkus:dev -Dquarkus.profile=dev-with-data</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="caching"><a class="anchor" href="#caching"></a>Caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Applications that frequently read the same entities can see their performance improved when the Hibernate ORM second-level cache is enabled.</p>
</div>
<div class="sect2">
<h3 id="caching-of-entities"><a class="anchor" href="#caching-of-entities"></a>Caching of entities</h3>
<div class="paragraph">
<p>To enable second-level cache, mark the entities that you want cached with <code>@javax.persistence.Cacheable</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
@Cacheable
public class Country {
    int dialInCode;
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>When an entity is annotated with <code>@Cacheable</code>, all its field values are cached except for collections and relations to other entities.</p>
</div>
<div class="paragraph">
<p>This means the entity can be loaded without querying the database, but be careful as it implies the loaded entity might not reflect recent changes in the database.</p>
</div>
</div>
<div class="sect2">
<h3 id="caching-of-collections-and-relations"><a class="anchor" href="#caching-of-collections-and-relations"></a>Caching of collections and relations</h3>
<div class="paragraph">
<p>Collections and relations need to be individually annotated to be cached; in this case the Hibernate specific <code>@org.hibernate.annotations.Cache</code> should be used, which requires also to specify the <code>CacheConcurrencyStrategy</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package org.acme;

@Entity
@Cacheable
public class Country {
    // ...

    @OneToMany
    @Cache(usage = CacheConcurrencyStrategy.READ_ONLY)
    List&lt;City&gt; cities;

    // ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="caching-of-queries"><a class="anchor" href="#caching-of-queries"></a>Caching of queries</h3>
<div class="paragraph">
<p>Queries can also benefit from second-level caching. Cached query results can be returned immediately to the caller, avoiding to run the query on the database.</p>
</div>
<div class="paragraph">
<p>Be careful as this implies the results might not reflect recent changes.</p>
</div>
<div class="paragraph">
<p>To cache a query, mark it as cacheable on the <code>Query</code> instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Query query = ...
query.setHint("org.hibernate.cacheable", Boolean.TRUE);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have a <code>NamedQuery</code> then you can enable caching directly on its definition, which will usually be on an entity:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">@Entity
@NamedQuery(name = "Fruits.findAll",
      query = "SELECT f FROM Fruit f ORDER BY f.name",
      hints = @QueryHint(name = "org.hibernate.cacheable", value = "true") )
public class Fruit {
   ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s all! Caching technology is already integrated and enabled by default in Quarkus, so it&#8217;s enough to set which ones are safe to be cached.</p>
</div>
</div>
<div class="sect2">
<h3 id="tuning-of-cache-regions"><a class="anchor" href="#tuning-of-cache-regions"></a>Tuning of Cache Regions</h3>
<div class="paragraph">
<p>Caches store the data in separate regions to isolate different portions of data; such regions are assigned a name, which is useful for configuring each region independently, or to monitor their statistics.</p>
</div>
<div class="paragraph">
<p>By default entities are cached in regions named after their fully qualified name, e.g. <code>org.acme.Country</code>.</p>
</div>
<div class="paragraph">
<p>Collections are cached in regions named after the fully qualified name of their owner entity and collection field name, separated by <code>#</code> character, e.g. <code>org.acme.Country#cities</code>.</p>
</div>
<div class="paragraph">
<p>All cached queries are by default kept in a single region dedicated to them called <code>default-query-results-region</code>.</p>
</div>
<div class="paragraph">
<p>All regions are bounded by size and time by default. The defaults are <code>10000</code> max entries, and <code>100</code> seconds as maximum idle time.</p>
</div>
<div class="paragraph">
<p>The size of each region can be customized via the <code>quarkus.hibernate-orm.cache."&lt;region_name&gt;".memory.object-count</code> property (Replace <em>&lt;region_name&gt;</em> with the actual region name).</p>
</div>
<div class="paragraph">
<p>To set the maximum idle time, provide the duration (see note on duration&#8217;s format below) via the <code>quarkus.hibernate-orm.cache."&lt;region_name&gt;".expiration.max-idle</code> property (Replace <em>&lt;region_name&gt;</em> with the actual region name).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The double quotes are mandatory if your region name contains a dot. For instance:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">quarkus.hibernate-orm.cache."org.acme.MyEntity".memory.object-count=1000</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The format for durations uses the standard <code>java.time.Duration</code> format.
You can learn more about it in the <a href="https://docs.oracle.com/javase/8/docs/api/java/time/Duration.html#parse-java.lang.CharSequence-">Duration#parse() javadoc</a>.</p>
</div>
<div class="paragraph">
<p>You can also provide duration values starting with a number.
In this case, if the value consists only of a number, the converter treats the value as seconds.
Otherwise, <code>PT</code> is implicitly appended to the value to obtain a standard <code>java.time.Duration</code> format.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="limitations-of-caching"><a class="anchor" href="#limitations-of-caching"></a>Limitations of Caching</h3>
<div class="paragraph">
<p>The caching technology provided within Quarkus is currently quite rudimentary and limited.</p>
</div>
<div class="paragraph">
<p>The team thought it was better to have <em>some</em> caching capability to start with, than having nothing; you can expect better caching solution to be integrated in future releases, and any help and feedback in this area is very welcome.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>These caches are kept locally, so they are not invalidated or updated when changes are made to the persistent store by other applications.</p>
</div>
<div class="paragraph">
<p>Also, when running multiple copies of the same application (in a cluster, for example on Kubernetes/OpenShift), caches in separate copies of the application aren&#8217;t synchronized.</p>
</div>
<div class="paragraph">
<p>For these reasons, enabling caching is only suitable when certain assumptions can be made: we strongly recommend that only entities, collections and queries which never change are cached. Or at most, that when indeed such an entity is mutated and allowed to be read out of date (stale) this has no impact on the expectations of the application.</p>
</div>
<div class="paragraph">
<p>Following this advice guarantees applications get the best performance out of the second-level cache and yet avoid unexpected behaviour.</p>
</div>
<div class="paragraph">
<p>On top of immutable data, in certain contexts it might be acceptable to enable caching also on mutable data; this could be a necessary tradeoff on selected
 entities which are read frequently and for which some degree of staleness is acceptable; this " acceptable degree of staleness" can be tuned by setting eviction properties.
 This is however not recommended and should be done with extreme care, as it might
 produce unexpected and unforeseen effects on the data.</p>
</div>
<div class="paragraph">
<p>Rather than enabling caching on mutable data, ideally a better solution would be to use a clustered cache; however at this time Quarkus doesn&#8217;t provide any such implementation: feel free to get in touch and let this need known so that the team can take this into account.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, the second-level cache can be disabled globally by setting <code>hibernate.cache.use_second_level_cache</code> to <code>false</code>; this is a setting that needs to be specified in the <code>persistence.xml</code> configuration file.</p>
</div>
<div class="paragraph">
<p>When second-level cache is disabled, all cache annotations are ignored and all queries are run ignoring caches; this is generally useful only to diagnose issues.</p>
</div>
</div>
</div>
</div>
    </div>
  </div>
</div>

  </div>

  <div class="content project-footer">
  <div class="footer-section">
    <div class="logo-wrapper">
      <a href="/"><img src="/assets/images/quarkus_logo_horizontal_rgb_reverse.svg" class="project-logo" title="Quarkus"></a>
    </div>
  </div>
  <div class="grid-wrapper">
    <p class="grid__item width-3-12">Quarkus is open. Quarkus and its extensions are available under the <a href='https://www.apache.org/licenses/LICENSE-2.0' target='_blank'>Apache Software License 2.0</a> or compatible license.<br /><br />This website was built with <a href='https://jekyllrb.com/' target='_blank'>Jekyll</a> is hosted on <a href='https://pages.github.com/' target='_blank'>Github Pages</a> and is completely open source. If you want to make it better, <a href='https://github.com/quarkusio/quarkusio.github.io' target='_blank'>fork the website</a> and show us what you’ve got.</p>

    
      <div class="width-1-12 project-links">
        <span>Navigation</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="/">Home</a></li>
          
            <li><a href="/guides">Guides</a></li>
          
            <li><a href="/get-started">Get Started</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Contribute</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://twitter.com/quarkusio">Follow us</a></li>
          
            <li><a href="https://github.com/quarkusio">GitHub</a></li>
          
        </ul>
      </div>
    
      <div class="width-1-12 project-links">
        <span>Get Help</span>
        <ul class="footer-links width-1-12">
          
            <li><a href="https://quarkusio.zulipchat.com">Chatroom</a></li>
          
            <li><a href="https://groups.google.com/forum/#!forum/quarkus-dev">Google&nbsp;Groups</a></li>
          
            <li><a href="/faq">FAQ</a></li>
          
        </ul>
      </div>
    

    
      <div class="width-6-12 more-links">
        <span>Quarkus is proudly made of a number of projects including ...</span>
        <ul class="footer-links">
          
            <li><a href="https://hibernate.org" target="_blank">Hibernate</a></li>
          
            <li><a href="https://netty.io" target="_blank">Netty</a></li>
          
            <li><a href="https://resteasy.github.io" target="_blank">RESTEasy</a></li>
          
            <li><a href="https://microprofile.io" target="_blank">Eclipse MicroProfile</a></li>
          
            <li><a href="https://vertx.io/" target="_blank">Eclipse Vert.x</a></li>
          
            <li><a href="https://camel.apache.org" target="_blank">Apache Camel</a></li>
          
        </ul>
      </div>
    
  </div>
</div>
  <div class="content redhat-footer">
  <div class="grid-wrapper">
    <span class="licence">
      <i class="fab fa-creative-commons"></i><i class="fab fa-creative-commons-by"></i> <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank">CC by 3.0</a>
      | <a href="https://www.redhat.com/en/about/privacy-policy">Red Hat Privacy Policy</a>
    </span>
    <span class="redhat">
      a Red Hat sponsored project   
    </span>
    <span class="redhat-logo">
      <a href="https://www.redhat.com/" target="_blank"><img src="/assets/images/redhat_reversed.svg"></a>
    </span>
  </div>
</div>


  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js" integrity="sha384-8gBf6Y4YYq7Jx97PIqmTwLPin4hxIzQw5aDmUg/DDhul9fFpbbLcLh3nTIIDJKhx" crossorigin="anonymous"></script>
  <script type="text/javascript" src="/assets/javascript/mobile-nav.js"></script>
  <script type="text/javascript" src="/assets/javascript/scroll-down.js"></script>
  <script src="/assets/javascript/satellite.js" type="text/javascript"></script>
</body>

</html>
